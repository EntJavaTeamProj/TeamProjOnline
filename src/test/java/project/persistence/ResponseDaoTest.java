package project.persistence;

import org.apache.logging.log4j.LogManager;
import org.apache.logging.log4j.Logger;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import project.entity.DigimonCardResponse;

import java.util.ArrayList;
import java.util.List;

import static org.junit.jupiter.api.Assertions.assertEquals;

public class ResponseDaoTest {
    private final Logger logger = LogManager.getLogger(this.getClass());
    DigimonCardDao cardDao;
    DigimonDao digimonDao;
    ResponseDao responseDao;
    private List<DigimonCardResponse> responseList;

    /**
     * Runs before each test
     * Refreshes the object
     */
    @BeforeEach
    void setUp() {
        cardDao = new DigimonCardDao();
        digimonDao = new DigimonDao();
        responseDao = new ResponseDao();
        responseList = new ArrayList<>();
    }

    /**
     * Retrieves digimon image from the response object that has both properties of digimon card and digimon
     * to prove that the digimon card response object has been combined with its digimon response object successfully.
     *
     */
    @Test
    void createResponseObjectSuccess() {
        responseList = responseDao.createResponseObjectList(cardDao.getCardByParameter("n=", "MetalGreymon"), digimonDao.getCardByName("MetalGreymon"));
        logger.info("Card Name: " + responseList.get(0).getCardName() + "\nDigimon Image URL: " + responseList.get(0).getDigimonImage());
        assertEquals("https://digimon.shadowsmith.com/img/metalgreymon.jpg", responseList.get(0).getDigimonImage());
    }

    /**
     * Converts response list to json data format
     *
     */
    @Test
    void createResponseJsonSuccess() {
        responseList = responseDao.createResponseObjectList(cardDao.getCardByParameter("n=", "MetalGreymon"), digimonDao.getCardByName("MetalGreymon"));
        String responseJson = responseDao.createResponseJson(responseList);
        logger.info(responseJson);
        assertEquals("[{\"soure_effect\":null,\"color\":\"Yellow\",\"digi_type\":\"Android\",\"card_sets\":[\"Series 1 Booster Pack\"],\"level\":0,\"card_rarity\":null,\"artist\":null,\"image_url\":\"https://images.digimoncard.io/images/cards/BO-01.jpg\",\"main_effect\":null,\"type\":\"Digimon\",\"dp\":0,\"stage\":\"Ultimate\",\"set_name\":\"Series 1 Booster Pack\",\"play_cost\":0,\"name\":\"MetalGreymon\",\"evolution_cost\":0,\"attribute\":\"Virus\",\"cardnumber\":\"BO-01\",\"digimonImage\":\"https://digimon.shadowsmith.com/img/metalgreymon.jpg\"},{\"soure_effect\":null,\"color\":\"Yellow\",\"digi_type\":\"Android\",\"card_sets\":[\"Series 3 Booster Pack\"],\"level\":0,\"card_rarity\":null,\"artist\":null,\"image_url\":\"https://images.digimoncard.io/images/cards/BO-143.jpg\",\"main_effect\":null,\"type\":\"Digimon\",\"dp\":0,\"stage\":\"Ultimate\",\"set_name\":\"Series 3 Booster Pack\",\"play_cost\":0,\"name\":\"MetalGreymon\",\"evolution_cost\":0,\"attribute\":\"Virus\",\"cardnumber\":\"BO-143\",\"digimonImage\":\"https://digimon.shadowsmith.com/img/metalgreymon.jpg\"},{\"soure_effect\":null,\"color\":\"Red\",\"digi_type\":\"Android\",\"card_sets\":[\"Series 2 Booster Pack\"],\"level\":0,\"card_rarity\":null,\"artist\":null,\"image_url\":\"https://images.digimoncard.io/images/cards/BO-80.jpg\",\"main_effect\":null,\"type\":\"Digimon\",\"dp\":0,\"stage\":\"Ultimate\",\"set_name\":\"Series 2 Booster Pack\",\"play_cost\":0,\"name\":\"MetalGreymon\",\"evolution_cost\":0,\"attribute\":\"Vaccine\",\"cardnumber\":\"BO-80\",\"digimonImage\":\"https://digimon.shadowsmith.com/img/metalgreymon.jpg\"},{\"soure_effect\":null,\"color\":\"Red\",\"digi_type\":\"Cyborg\",\"card_sets\":[\"BT-01: Booster New Evolution\",\"BT01-03: Release Special Booster Ver.1.0\"],\"level\":5,\"card_rarity\":null,\"artist\":\"TANIMESO\",\"image_url\":\"https://images.digimoncard.io/images/cards/BT1-021.jpg\",\"main_effect\":null,\"type\":\"Digimon\",\"dp\":7000,\"stage\":\"Ultimate\",\"set_name\":\"BT-01: Booster New Evolution\",\"play_cost\":6,\"name\":\"MetalGreymon\",\"evolution_cost\":3,\"attribute\":\"Vaccine\",\"cardnumber\":\"BT1-021\",\"digimonImage\":\"https://digimon.shadowsmith.com/img/metalgreymon.jpg\"},{\"soure_effect\":null,\"color\":\"Red\",\"digi_type\":\"Cyborg\",\"card_sets\":[\"BT01-03: Release Special Booster Ver.1.0\",\"BT-01: Booster New Evolution\",\"BT-01: Booster New Evolution\",\"BT01-03: Release Special Booster Ver.1.0\"],\"level\":5,\"card_rarity\":null,\"artist\":\"Naochika Morishita\",\"image_url\":\"https://images.digimoncard.io/images/cards/BT1-114.jpg\",\"main_effect\":null,\"type\":\"Digimon\",\"dp\":9000,\"stage\":\"Ultimate\",\"set_name\":\"BT01-03: Release Special Booster Ver.1.0\",\"play_cost\":8,\"name\":\"MetalGreymon\",\"evolution_cost\":3,\"attribute\":\"Virus\",\"cardnumber\":\"BT1-114\",\"digimonImage\":\"https://digimon.shadowsmith.com/img/metalgreymon.jpg\"},{\"soure_effect\":null,\"color\":\"Black\",\"digi_type\":\"Cyborg\",\"card_sets\":[\"BT-02: Booster Ultimate Power\",\"BT01-03: Release Special Booster Ver.1.0\",\"1st Anniversary Adventure Pack\"],\"level\":5,\"card_rarity\":null,\"artist\":\"Tonamikanji\",\"image_url\":\"https://images.digimoncard.io/images/cards/BT2-063.jpg\",\"main_effect\":null,\"type\":\"Digimon\",\"dp\":7000,\"stage\":\"Ultimate\",\"set_name\":\"BT-02: Booster Ultimate Power\",\"play_cost\":8,\"name\":\"MetalGreymon\",\"evolution_cost\":3,\"attribute\":\"Vaccine\",\"cardnumber\":\"BT2-063\",\"digimonImage\":\"https://digimon.shadowsmith.com/img/metalgreymon.jpg\"},{\"soure_effect\":null,\"color\":\"Red\",\"digi_type\":\"Cyborg\",\"card_sets\":[\"BT01-03: Release Special Booster Ver.1.5\",\"BT-03: Booster Union Impact\"],\"level\":5,\"card_rarity\":null,\"artist\":\"sasasi\",\"image_url\":\"https://images.digimoncard.io/images/cards/BT3-015.jpg\",\"main_effect\":null,\"type\":\"Digimon\",\"dp\":7000,\"stage\":\"Ultimate\",\"set_name\":\"BT01-03: Release Special Booster Ver.1.5\",\"play_cost\":8,\"name\":\"MetalGreymon\",\"evolution_cost\":3,\"attribute\":\"Virus\",\"cardnumber\":\"BT3-015\",\"digimonImage\":\"https://digimon.shadowsmith.com/img/metalgreymon.jpg\"},{\"soure_effect\":null,\"color\":\"Red\",\"digi_type\":\"Cyborg\",\"card_sets\":[\"BT-05: Booster Battle Of Omni\"],\"level\":5,\"card_rarity\":null,\"artist\":\"sasasi\",\"image_url\":\"https://images.digimoncard.io/images/cards/BT5-015.jpg\",\"main_effect\":null,\"type\":\"Digimon\",\"dp\":8000,\"stage\":\"Ultimate\",\"set_name\":\"BT-05: Booster Battle Of Omni\",\"play_cost\":8,\"name\":\"MetalGreymon: Alterous Mode\",\"evolution_cost\":3,\"attribute\":\"Vaccine\",\"cardnumber\":\"BT5-015\",\"digimonImage\":null},{\"soure_effect\":null,\"color\":\"Red\",\"digi_type\":\"Cyborg\",\"card_sets\":[\"BT-07: Booster Next Adventure\",\"BT-07: Booster Next Adventure\"],\"level\":5,\"card_rarity\":null,\"artist\":\"Kenji  Watanabe\",\"image_url\":\"https://images.digimoncard.io/images/cards/BT7-013.jpg\",\"main_effect\":null,\"type\":\"Digimon\",\"dp\":7000,\"stage\":\"Ultimate\",\"set_name\":\"BT-07: Booster Next Adventure\",\"play_cost\":7,\"name\":\"MetalGreymon\",\"evolution_cost\":3,\"attribute\":\"Vaccine\",\"cardnumber\":\"BT7-013\",\"digimonImage\":\"https://digimon.shadowsmith.com/img/metalgreymon.jpg\"},{\"soure_effect\":null,\"color\":\"Red\",\"digi_type\":\"Cyborg\",\"card_sets\":[\"BT-08: Booster New Awakening\",\"BT-08: Booster New Hero\"],\"level\":5,\"card_rarity\":null,\"artist\":\"As'Maria\",\"image_url\":\"https://images.digimoncard.io/images/cards/BT8-067.jpg\",\"main_effect\":null,\"type\":\"Digimon\",\"dp\":8000,\"stage\":\"Ultimate\",\"set_name\":\"BT-08: Booster New Awakening\",\"play_cost\":8,\"name\":\"MetalGreymon\",\"evolution_cost\":4,\"attribute\":\"Virus\",\"cardnumber\":\"BT8-067\",\"digimonImage\":\"https://digimon.shadowsmith.com/img/metalgreymon.jpg\"},{\"soure_effect\":null,\"color\":\"Red\",\"digi_type\":\"Cyborg\",\"card_sets\":[\"BT-09: Booster X Record\"],\"level\":5,\"card_rarity\":null,\"artist\":\"As'Maria\",\"image_url\":\"https://images.digimoncard.io/images/cards/BT9-015.jpg\",\"main_effect\":null,\"type\":\"Digimon\",\"dp\":8000,\"stage\":\"Ultimate\",\"set_name\":\"BT-09: Booster X Record\",\"play_cost\":8,\"name\":\"MetalGreymon (X Antibody)\",\"evolution_cost\":3,\"attribute\":\"Vaccine\",\"cardnumber\":\"BT9-015\",\"digimonImage\":null},{\"soure_effect\":null,\"color\":\"Colorless\",\"digi_type\":\"Android\",\"card_sets\":[\"Digimon Collectible Card Game Starter Set 2\"],\"level\":0,\"card_rarity\":null,\"artist\":null,\"image_url\":\"https://images.digimoncard.io/images/cards/DM-062.jpg\",\"main_effect\":null,\"type\":\"Digimon\",\"dp\":0,\"stage\":\"Ultimate\",\"set_name\":\"Digimon Collectible Card Game Starter Set 2\",\"play_cost\":0,\"name\":\"Metalgreymon\",\"evolution_cost\":0,\"attribute\":\"Vaccine\",\"cardnumber\":\"DM-062\",\"digimonImage\":null},{\"soure_effect\":null,\"color\":\"Red\",\"digi_type\":\"Cyborg\",\"card_sets\":[\"Classic Collection EX-01\",\"Classic Collection EX-01\"],\"level\":5,\"card_rarity\":null,\"artist\":null,\"image_url\":\"https://images.digimoncard.io/images/cards/EX1-008.jpg\",\"main_effect\":null,\"type\":\"Digimon\",\"dp\":7000,\"stage\":\"Ultimate\",\"set_name\":\"Classic Collection EX-01\",\"play_cost\":7,\"name\":\"MetalGreymon\",\"evolution_cost\":3,\"attribute\":\"Vaccine\",\"cardnumber\":\"EX1-008\",\"digimonImage\":\"https://digimon.shadowsmith.com/img/metalgreymon.jpg\"},{\"soure_effect\":null,\"color\":\"Red\",\"digi_type\":\"Cyborg\",\"card_sets\":[\"2nd Anniversary Promotion Pack\"],\"level\":5,\"card_rarity\":null,\"artist\":\"Kenji Watanabe\",\"image_url\":\"https://images.digimoncard.io/images/cards/P-072.jpg\",\"main_effect\":null,\"type\":\"Digimon\",\"dp\":7000,\"stage\":\"Ultimate\",\"set_name\":\"2nd Anniversary Promotion Pack\",\"play_cost\":7,\"name\":\"MetalGreymon: Alterous Mode\",\"evolution_cost\":3,\"attribute\":\"Vaccine\",\"cardnumber\":\"P-072\",\"digimonImage\":null},{\"soure_effect\":null,\"color\":\"Red\",\"digi_type\":\"Cyborg\",\"card_sets\":[\"ST-1: Starter Deck Gaia Red\",\"Official Tournament Pack Vol. 2\",\"Tamer Battle Pack 1\",\"Tamer Battle Pack 1\",\"Tamer Battle\"],\"level\":5,\"card_rarity\":null,\"artist\":\"sasasi\",\"image_url\":\"https://images.digimoncard.io/images/cards/ST1-09.jpg\",\"main_effect\":null,\"type\":\"Digimon\",\"dp\":7000,\"stage\":\"Ultimate\",\"set_name\":\"ST-1: Starter Deck Gaia Red\",\"play_cost\":7,\"name\":\"MetalGreymon\",\"evolution_cost\":3,\"attribute\":\"Vaccine\",\"cardnumber\":\"ST1-09\",\"digimonImage\":\"https://digimon.shadowsmith.com/img/metalgreymon.jpg\"},{\"soure_effect\":null,\"color\":\"Black\",\"digi_type\":\"Cyborg\",\"card_sets\":[\"ST-5: Starter Deck Machine Black\"],\"level\":5,\"card_rarity\":null,\"artist\":\"Nakano Haito\",\"image_url\":\"https://images.digimoncard.io/images/cards/ST5-09.jpg\",\"main_effect\":null,\"type\":\"Digimon\",\"dp\":7000,\"stage\":\"Ultimate\",\"set_name\":\"ST-5: Starter Deck Machine Black\",\"play_cost\":6,\"name\":\"MetalGreymon\",\"evolution_cost\":3,\"attribute\":\"Virus\",\"cardnumber\":\"ST5-09\",\"digimonImage\":\"https://digimon.shadowsmith.com/img/metalgreymon.jpg\"}]", responseJson);
    }
}
